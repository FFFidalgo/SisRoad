<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SisRoad - Sistema de Gerenciamento de Projetos Rodoviários</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.0.0/css/all.min.css">
    <script type="text/javascript" src="https://me.kis.v2.scr.kaspersky-labs.com/FD126C42-EBFA-4E12-B309-BB3FDD723AC1/main.js?attr=LJYomZDvhCE699asMMh5GH4-X_AvlF6X0Il2BmVaxt19WV8UPe81fqq5GJIsZM4-ZYy-giNNh7TpXHsudx7RDINEeDduxFCPvtfjWVe32YAdrJoLWh0V5evoTwGnszK62IQnIY_H1Chi480RzHPIi0DTxGRSXexYKyE15plqZZs" charset="UTF-8"></script><style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .hidden {
            display: none;
        }
        .page-section {
            page-break-inside: avoid;
        }
        .progress-bar {
            height: 12px;
            border-radius: 6px;
        }
        .custom-card {
            transition: all 0.3s ease;
        }
        .custom-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .badge {
            font-size: 0.8rem;
            padding: 0.2rem 0.5rem;
            border-radius: 9999px;
        }
        .tab-button {
            padding: 0.5rem 1rem;
            border-bottom: 2px solid transparent;
            cursor: pointer;
        }
        .tab-button.active {
            border-color: #4338ca;
            color: #4338ca;
            font-weight: 600;
        }
        .gantt-chart {
            position: relative;
            overflow-x: auto;
        }
        .gantt-bar {
            position: absolute;
            height: 20px;
            border-radius: 4px;
        }
        /* Estilos específicos para status */
        .status-nao-iniciado { background-color: #cbd5e0; }
        .status-em-andamento { background-color: #93c5fd; }
        .status-atrasado { background-color: #fca5a5; }
        .status-concluido { background-color: #86efac; }
        .status-suspenso { background-color: #fcd34d; }
        /* Table styles */
        table {
            border-collapse: collapse;
            width: 100%;
        }
        th, td {
            padding: 8px 12px;
            text-align: left;
            border: 1px solid #e2e8f0;
        }
        th {
            background-color: #f8fafc;
        }
        tr:nth-child(even) {
            background-color: #f1f5f9;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="container mx-auto px-4 py-8">
        <!-- Cabeçalho -->
        <header class="bg-indigo-700 text-white rounded-lg shadow-lg p-6 mb-8 page-section">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-3xl font-bold flex items-center">
                        <i class="fas fa-road mr-3"></i>
                        SisRoad
                    </h1>
                    <p class="mt-1 text-indigo-200">Sistema de Gerenciamento de Projetos Rodoviários e Infraestrutura</p>
                </div>
                <div class="flex space-x-4">
                    <button id="btnNovoProjeto" class="bg-white text-indigo-700 px-4 py-2 rounded-md font-medium flex items-center hover:bg-indigo-100">
                        <i class="fas fa-plus mr-2"></i> Novo Projeto
                    </button>
                    <button id="btnGerenciarDisciplinas" class="bg-indigo-600 text-white px-4 py-2 rounded-md font-medium flex items-center hover:bg-indigo-500">
                        <i class="fas fa-tasks mr-2"></i> Gerenciar Disciplinas
                    </button>
                </div>
            </div>
        </header>

        <!-- Filtro e Pesquisa -->
        <div class="bg-white rounded-lg shadow p-4 mb-8 page-section" id="secaoFiltros">
            <div class="flex flex-wrap gap-4 items-end">
                <div class="flex-1 min-w-[200px]">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Pesquisar Projetos</label>
                    <div class="relative">
                        <input type="text" id="pesquisaProjeto" class="w-full px-4 py-2 border rounded-md focus:ring-indigo-500 focus:border-indigo-500" placeholder="Digite o nome do projeto...">
                        <i class="fas fa-search absolute right-3 top-3 text-gray-400"></i>
                    </div>
                </div>
                <div class="w-48">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                    <select id="filtroStatus" class="w-full px-4 py-2 border rounded-md focus:ring-indigo-500 focus:border-indigo-500">
                        <option value="">Todos</option>
                        <option value="Não Iniciado">Não Iniciado</option>
                        <option value="Em Andamento">Em Andamento</option>
                        <option value="Atrasado">Atrasado</option>
                        <option value="Concluído">Concluído</option>
                        <option value="Suspenso">Suspenso</option>
                    </select>
                </div>
                <div class="w-48">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Disciplina</label>
                    <select id="filtroDisciplina" class="w-full px-4 py-2 border rounded-md focus:ring-indigo-500 focus:border-indigo-500">
                        <option value="">Todas</option>
                        <!-- Preenchido dinamicamente -->
                    </select>
                </div>
                <div class="w-48">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Ordenar por</label>
                    <select id="ordenarPor" class="w-full px-4 py-2 border rounded-md focus:ring-indigo-500 focus:border-indigo-500">
                        <option value="nome">Nome</option>
                        <option value="dataInicio">Data de Início</option>
                        <option value="dataFim">Data de Término</option>
                        <option value="status">Status</option>
                        <option value="progresso">Progresso</option>
                    </select>
                </div>
                <button id="btnLimparFiltros" class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded-md font-medium">
                    <i class="fas fa-times mr-2"></i> Limpar Filtros
                </button>
            </div>
        </div>

        <!-- Dashboard / Resumo -->
        <div class="bg-white rounded-lg shadow p-6 mb-8 page-section" id="secaoDashboard">
            <h2 class="text-xl font-bold text-gray-800 mb-4">Dashboard</h2>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                    <h3 class="text-sm font-medium text-gray-500">Total de Projetos</h3>
                    <p class="text-2xl font-bold text-blue-600 flex items-center mt-1">
                        <i class="fas fa-folder mr-2"></i>
                        <span id="totalProjetos">0</span>
                    </p>
                </div>
                <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                    <h3 class="text-sm font-medium text-gray-500">Projetos Concluídos</h3>
                    <p class="text-2xl font-bold text-green-600 flex items-center mt-1">
                        <i class="fas fa-check-circle mr-2"></i>
                        <span id="projetosConcluidos">0</span>
                    </p>
                </div>
                <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-200">
                    <h3 class="text-sm font-medium text-gray-500">Em Andamento</h3>
                    <p class="text-2xl font-bold text-yellow-600 flex items-center mt-1">
                        <i class="fas fa-spinner mr-2"></i>
                        <span id="projetosAndamento">0</span>
                    </p>
                </div>
                <div class="bg-red-50 p-4 rounded-lg border border-red-200">
                    <h3 class="text-sm font-medium text-gray-500">Projetos Atrasados</h3>
                    <p class="text-2xl font-bold text-red-600 flex items-center mt-1">
                        <i class="fas fa-exclamation-triangle mr-2"></i>
                        <span id="projetosAtrasados">0</span>
                    </p>
                </div>
            </div>
            
            <div class="mb-4">
                <h3 class="text-lg font-semibold text-gray-700 mb-2">Progresso por Disciplina</h3>
                <div id="progressoDisciplinas" class="space-y-4">
                    <!-- Preenchido dinamicamente -->
                </div>
            </div>
        </div>

        <!-- Lista de Projetos -->
        <div class="bg-white rounded-lg shadow p-6 mb-8 page-section" id="secaoListaProjetos">
            <h2 class="text-xl font-bold text-gray-800 mb-4">Projetos</h2>
            <div id="listaProjetos" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Preenchido dinamicamente -->
            </div>
            <div id="nenhumProjeto" class="hidden text-center py-8">
                <i class="fas fa-folder-open text-4xl text-gray-300 mb-3"></i>
                <p class="text-gray-500">Nenhum projeto encontrado. Crie um novo projeto para começar.</p>
            </div>
        </div>

        <!-- Modais -->
        <!-- Modal Novo/Editar Projeto -->
        <div id="modalProjeto" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg shadow-lg w-full max-w-4xl max-h-screen overflow-auto">
                <div class="p-6 border-b">
                    <h2 id="tituloModalProjeto" class="text-xl font-bold text-gray-800">Novo Projeto</h2>
                </div>
                <div class="p-6">
                    <form id="formProjeto">
                        <input type="hidden" id="projetoId">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Nome do Projeto*</label>
                                <input type="text" id="nomeProjeto" required class="w-full px-4 py-2 border rounded-md focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Código do Projeto</label>
                                <input type="text" id="codigoProjeto" class="w-full px-4 py-2 border rounded-md focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Rodovia/Trecho*</label>
                                <input type="text" id="rodovia" required class="w-full px-4 py-2 border rounded-md focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Status*</label>
                                <select id="statusProjeto" required class="w-full px-4 py-2 border rounded-md focus:ring-indigo-500 focus:border-indigo-500">
                                    <option value="Não Iniciado">Não Iniciado</option>
                                    <option value="Em Andamento">Em Andamento</option>
                                    <option value="Atrasado">Atrasado</option>
                                    <option value="Concluído">Concluído</option>
                                    <option value="Suspenso">Suspenso</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Cliente/Órgão*</label>
                                <input type="text" id="cliente" required class="w-full px-4 py-2 border rounded-md focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Gerente Responsável*</label>
                                <input type="text" id="gerente" required class="w-full px-4 py-2 border rounded-md focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Data de Início*</label>
                                <input type="date" id="dataInicio" required class="w-full px-4 py-2 border rounded-md focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Data de Término Prevista*</label>
                                <input type="date" id="dataFim" required class="w-full px-4 py-2 border rounded-md focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Descrição do Projeto</label>
                                <textarea id="descricaoProjeto" rows="3" class="w-full px-4 py-2 border rounded-md focus:ring-indigo-500 focus:border-indigo-500"></textarea>
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Progresso Global</label>
                                <div class="flex items-center">
                                    <input type="range" id="progressoGlobal" min="0" max="100" step="5" class="w-full mr-3">
                                    <span id="valorProgresso" class="w-12 text-right">0%</span>
                                </div>
                            </div>
                        </div>

                        <div class="border-t border-b py-6 my-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">Disciplinas do Projeto</h3>
                            <div id="disciplinasProjeto" class="space-y-4">
                                <!-- Preenchido dinamicamente -->
                                <p id="semDisciplinas" class="text-gray-500 italic">Nenhuma disciplina disponível. Adicione disciplinas no gerenciador de disciplinas.</p>
                            </div>
                        </div>

                        <div class="flex justify-end space-x-3">
                            <button type="button" id="btnCancelarProjeto" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300">Cancelar</button>
                            <button type="submit" id="btnSalvarProjeto" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">
                                <i class="fas fa-save mr-2"></i>Salvar Projeto
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Modal Gerenciar Disciplinas -->
        <div id="modalDisciplinas" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg shadow-lg w-full max-w-3xl max-h-screen overflow-auto">
                <div class="p-6 border-b flex justify-between items-center">
                    <h2 class="text-xl font-bold text-gray-800">Gerenciar Disciplinas</h2>
                    <button id="btnFecharDisciplinas" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="p-6">
                    <form id="formDisciplina" class="mb-6">
                        <div class="flex space-x-3">
                            <div class="flex-1">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Nome da Disciplina</label>
                                <input type="text" id="nomeDisciplina" required class="w-full px-4 py-2 border rounded-md focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div class="w-48">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Cor (opcional)</label>
                                <input type="color" id="corDisciplina" class="h-10 w-full rounded-md border" value="#4F46E5">
                            </div>
                            <div class="flex items-end">
                                <button type="submit" id="btnAdicionarDisciplina" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">
                                    <i class="fas fa-plus mr-2"></i>Adicionar
                                </button>
                            </div>
                        </div>
                    </form>

                    <div class="border-t pt-4">
                        <h3 class="text-lg font-semibold text-gray-700 mb-3">Disciplinas Cadastradas</h3>
                        <div class="overflow-hidden overflow-x-auto border rounded-lg">
                            <table class="min-w-full">
                                <thead>
                                    <tr>
                                        <th>Nome</th>
                                        <th>Cor</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="listaDisciplinas">
                                    <!-- Preenchido dinamicamente -->
                                </tbody>
                            </table>
                        </div>
                        <p id="nenhumaDisciplina" class="hidden text-center py-4 text-gray-500">Nenhuma disciplina cadastrada.</p>
                    </div>

                    <div class="mt-6 pt-4 border-t">
                        <button type="button" id="btnCarregarPadrao" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700">
                            <i class="fas fa-sync-alt mr-2"></i>Carregar Disciplinas Padrão
                        </button>
                        <p class="text-sm text-gray-500 mt-2">
                            <i class="fas fa-info-circle mr-1"></i>
                            Isso irá adicionar disciplinas comuns em projetos rodoviários, sem remover as disciplinas já existentes.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal Visualizar Projeto -->
        <div id="modalVisualizarProjeto" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg shadow-lg w-full max-w-5xl max-h-screen overflow-auto">
                <div class="p-6 border-b flex justify-between items-center">
                    <h2 id="tituloProjetoView" class="text-xl font-bold text-gray-800">Detalhes do Projeto</h2>
                    <button id="btnFecharVisualizacao" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="p-6">
                    <!-- Tabs para navegação -->
                    <div class="flex border-b mb-6">
                        <button class="tab-button active" data-tab="tab-informacoes">
                            <i class="fas fa-info-circle mr-2"></i>Informações Gerais
                        </button>
                        <button class="tab-button" data-tab="tab-disciplinas">
                            <i class="fas fa-tasks mr-2"></i>Disciplinas
                        </button>
                        <button class="tab-button" data-tab="tab-cronograma">
                            <i class="fas fa-calendar-alt mr-2"></i>Cronograma
                        </button>
                    </div>

                    <!-- Conteúdo das Tabs -->
                    <div id="tab-informacoes" class="tab-content">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4 mb-6">
                            <div>
                                <h3 class="text-sm font-medium text-gray-500">Nome do Projeto</h3>
                                <p id="viewNomeProjeto" class="text-gray-800 font-medium">-</p>
                            </div>
                            <div>
                                <h3 class="text-sm font-medium text-gray-500">Código</h3>
                                <p id="viewCodigoProjeto" class="text-gray-800">-</p>
                            </div>
                            <div>
                                <h3 class="text-sm font-medium text-gray-500">Rodovia/Trecho</h3>
                                <p id="viewRodovia" class="text-gray-800">-</p>
                            </div>
                            <div>
                                <h3 class="text-sm font-medium text-gray-500">Cliente/Órgão</h3>
                                <p id="viewCliente" class="text-gray-800">-</p>
                            </div>
                            <div>
                                <h3 class="text-sm font-medium text-gray-500">Gerente Responsável</h3>
                                <p id="viewGerente" class="text-gray-800">-</p>
                            </div>
                            <div>
                                <h3 class="text-sm font-medium text-gray-500">Status</h3>
                                <p id="viewStatus" class="inline-block px-2 py-1 rounded text-white">-</p>
                            </div>
                            <div>
                                <h3 class="text-sm font-medium text-gray-500">Data de Início</h3>
                                <p id="viewDataInicio" class="text-gray-800">-</p>
                            </div>
                            <div>
                                <h3 class="text-sm font-medium text-gray-500">Data de Término Prevista</h3>
                                <p id="viewDataFim" class="text-gray-800">-</p>
                            </div>
                            <div class="md:col-span-2">
                                <h3 class="text-sm font-medium text-gray-500">Descrição</h3>
                                <p id="viewDescricao" class="text-gray-800">-</p>
                            </div>
                            <div class="md:col-span-2">
                                <h3 class="text-sm font-medium text-gray-500">Progresso do Projeto</h3>
                                <div class="flex items-center">
                                    <div class="flex-1 bg-gray-200 rounded-full h-4 mr-3">
                                        <div id="viewProgresso" class="bg-indigo-600 h-4 rounded-full"></div>
                                    </div>
                                    <span id="viewProgressoTexto" class="text-gray-800 font-medium">0%</span>
                                </div>
                            </div>
                        </div>

                        <div class="flex space-x-3 justify-end">
                            <button id="btnEditarProjeto" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">
                                <i class="fas fa-edit mr-2"></i>Editar Projeto
                            </button>
                            <button id="btnDeletarProjeto" class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700">
                                <i class="fas fa-trash-alt mr-2"></i>Deletar Projeto
                            </button>
                        </div>
                    </div>

                    <div id="tab-disciplinas" class="tab-content hidden">
                        <div class="mb-4 flex justify-between items-center">
                            <h3 class="text-lg font-semibold text-gray-800">Disciplinas do Projeto</h3>
                            <button id="btnAtualizarDisciplinas" class="text-indigo-600 hover:text-indigo-800">
                                <i class="fas fa-sync-alt mr-1"></i>Atualizar
                            </button>
                        </div>
                        <div id="viewDisciplinas" class="space-y-6">
                            <!-- Preenchido dinamicamente -->
                        </div>
                        <p id="viewSemDisciplinas" class="hidden text-center py-8 text-gray-500">
                            Nenhuma disciplina associada a este projeto.
                        </p>
                    </div>

                    <div id="tab-cronograma" class="tab-content hidden">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Cronograma do Projeto</h3>
                        <div class="gantt-chart border rounded-lg p-4 overflow-x-auto">
                            <div id="viewCronograma" style="height: 300px; position: relative;">
                                <!-- Preenchido dinamicamente -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Confirmação de Exclusão -->
        <div id="modalConfirmacao" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg shadow-lg w-full max-w-md">
                <div class="p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-3">Confirmação</h3>
                    <p id="mensagemConfirmacao" class="text-gray-600 mb-6">Tem certeza que deseja excluir este item?</p>
                    <div class="flex justify-end space-x-3">
                        <button id="btnCancelarConfirmacao" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300">Cancelar</button>
                        <button id="btnConfirmarExclusao" class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700">Confirmar Exclusão</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Modelo de dados
            let projetos = JSON.parse(localStorage.getItem('projetos')) || [];
            let disciplinas = JSON.parse(localStorage.getItem('disciplinas')) || [];
            let projetoAtualId = null;
            let itemParaExcluir = null;
            let tipoExclusao = null;

            // Referências de elementos
            const modalProjeto = document.getElementById('modalProjeto');
            const modalDisciplinas = document.getElementById('modalDisciplinas');
            const modalVisualizarProjeto = document.getElementById('modalVisualizarProjeto');
            const modalConfirmacao = document.getElementById('modalConfirmacao');
            const formProjeto = document.getElementById('formProjeto');
            const formDisciplina = document.getElementById('formDisciplina');
            const listaProjetos = document.getElementById('listaProjetos');
            const listaDisciplinas = document.getElementById('listaDisciplinas');
            const disciplinasProjeto = document.getElementById('disciplinasProjeto');
            const filtroDisciplina = document.getElementById('filtroDisciplina');
            const progressoGlobal = document.getElementById('progressoGlobal');
            const valorProgresso = document.getElementById('valorProgresso');

            // Funções de inicialização
            function inicializar() {
                atualizarContadores();
                carregarProjetos();
                atualizarListaDisciplinas();
                atualizarFiltroDisciplinas();
                
                // Verificar se há projetos
                if (projetos.length === 0) {
                    document.getElementById('nenhumProjeto').classList.remove('hidden');
                } else {
                    document.getElementById('nenhumProjeto').classList.add('hidden');
                }
                
                // Verificar se há disciplinas
                if (disciplinas.length === 0) {
                    document.getElementById('nenhumaDisciplina').classList.remove('hidden');
                    document.getElementById('semDisciplinas').classList.remove('hidden');
                } else {
                    document.getElementById('nenhumaDisciplina').classList.add('hidden');
                    document.getElementById('semDisciplinas').classList.add('hidden');
                }
            }

            // Progress bar
            progressoGlobal.addEventListener('input', function() {
                valorProgresso.textContent = this.value + '%';
            });

            // Funções para atualizar a interface
            function atualizarContadores() {
                document.getElementById('totalProjetos').textContent = projetos.length;
                document.getElementById('projetosConcluidos').textContent = projetos.filter(p => p.status === 'Concluído').length;
                document.getElementById('projetosAndamento').textContent = projetos.filter(p => p.status === 'Em Andamento').length;
                document.getElementById('projetosAtrasados').textContent = projetos.filter(p => p.status === 'Atrasado').length;
                
                atualizarProgressoDisciplinas();
            }

            function atualizarProgressoDisciplinas() {
                const progressoDisciplinas = document.getElementById('progressoDisciplinas');
                progressoDisciplinas.innerHTML = '';
                
                if (disciplinas.length === 0) {
                    progressoDisciplinas.innerHTML = '<p class="text-gray-500 italic">Nenhuma disciplina cadastrada para análise.</p>';
                    return;
                }
                
                // Calcular progresso médio por disciplina
                const progressoPorDisciplina = {};
                let contagemPorDisciplina = {};
                
                disciplinas.forEach(d => {
                    progressoPorDisciplina[d.id] = 0;
                    contagemPorDisciplina[d.id] = 0;
                });
                
                projetos.forEach(projeto => {
                    if (projeto.disciplinas) {
                        projeto.disciplinas.forEach(pd => {
                            if (progressoPorDisciplina.hasOwnProperty(pd.disciplinaId)) {
                                progressoPorDisciplina[pd.disciplinaId] += parseInt(pd.progresso || 0);
                                contagemPorDisciplina[pd.disciplinaId]++;
                            }
                        });
                    }
                });
                
                // Criar barras de progresso
                disciplinas.forEach(d => {
                    const progresso = contagemPorDisciplina[d.id] > 0 
                        ? Math.round(progressoPorDisciplina[d.id] / contagemPorDisciplina[d.id]) 
                        : 0;
                    
                    const progressoHTML = `
                        <div>
                            <div class="flex justify-between mb-1">
                                <span class="text-sm font-medium">${d.nome}</span>
                                <span class="text-sm font-medium">${progresso}%</span>
                            </div>
                            <div class="bg-gray-200 rounded-full">
                                <div class="progress-bar" style="width: ${progresso}%; background-color: ${d.cor || '#4F46E5'}"></div>
                            </div>
                            <div class="text-xs text-gray-500 mt-1">
                                ${contagemPorDisciplina[d.id]} projeto(s)
                            </div>
                        </div>
                    `;
                    progressoDisciplinas.insertAdjacentHTML('beforeend', progressoHTML);
                });
            }

            function atualizarFiltroDisciplinas() {
                filtroDisciplina.innerHTML = '<option value="">Todas</option>';
                disciplinas.forEach(d => {
                    filtroDisciplina.insertAdjacentHTML('beforeend', `
                        <option value="${d.id}">${d.nome}</option>
                    `);
                });
            }

            function carregarProjetos() {
                listaProjetos.innerHTML = '';
                
                const pesquisa = document.getElementById('pesquisaProjeto').value.toLowerCase();
                const filtroStatus = document.getElementById('filtroStatus').value;
                const filtroDisciplinaValue = document.getElementById('filtroDisciplina').value;
                const ordenacao = document.getElementById('ordenarPor').value;
                
                // Filtrar projetos
                let projetosFiltrados = projetos.filter(projeto => {
                    // Filtro por texto
                    const matchesTexto = projeto.nome.toLowerCase().includes(pesquisa) || 
                                        (projeto.codigo && projeto.codigo.toLowerCase().includes(pesquisa)) ||
                                        projeto.rodovia.toLowerCase().includes(pesquisa);
                    
                    // Filtro por status
                    const matchesStatus = !filtroStatus || projeto.status === filtroStatus;
                    
                    // Filtro por disciplina
                    const matchesDisciplina = !filtroDisciplinaValue || 
                                            (projeto.disciplinas && projeto.disciplinas.some(d => d.disciplinaId === filtroDisciplinaValue));
                    
                    return matchesTexto && matchesStatus && matchesDisciplina;
                });
                
                // Ordenar projetos
                projetosFiltrados.sort((a, b) => {
                    switch(ordenacao) {
                        case 'nome':
                            return a.nome.localeCompare(b.nome);
                        case 'dataInicio':
                            return new Date(a.dataInicio) - new Date(b.dataInicio);
                        case 'dataFim':
                            return new Date(a.dataFim) - new Date(b.dataFim);
                        case 'status':
                            return a.status.localeCompare(b.status);
                        case 'progresso':
                            return parseInt(b.progresso || 0) - parseInt(a.progresso || 0);
                        default:
                            return 0;
                    }
                });
                
                // Mostrar mensagem se não houver projetos
                if (projetosFiltrados.length === 0) {
                    document.getElementById('nenhumProjeto').classList.remove('hidden');
                } else {
                    document.getElementById('nenhumProjeto').classList.add('hidden');
                }
                
                // Renderizar projetos
                projetosFiltrados.forEach(projeto => {
                    // Calcular dias restantes
                    const hoje = new Date();
                    const dataFim = new Date(projeto.dataFim);
                    const diasRestantes = Math.ceil((dataFim - hoje) / (1000 * 60 * 60 * 24));
                    
                    // Determinar classe de status
                    let statusClass = '';
                    switch(projeto.status) {
                        case 'Não Iniciado': statusClass = 'bg-gray-500'; break;
                        case 'Em Andamento': statusClass = 'bg-blue-500'; break;
                        case 'Atrasado': statusClass = 'bg-red-500'; break;
                        case 'Concluído': statusClass = 'bg-green-500'; break;
                        case 'Suspenso': statusClass = 'bg-yellow-500'; break;
                        default: statusClass = 'bg-gray-500';
                    }
                    
                    const card = `
                        <div class="custom-card bg-white border rounded-lg shadow-sm overflow-hidden" data-id="${projeto.id}">
                            <div class="p-4 border-b">
                                <div class="flex justify-between items-start">
                                    <h3 class="text-lg font-bold text-gray-800">${projeto.nome}</h3>
                                    <span class="badge ${statusClass} text-white">${projeto.status}</span>
                                </div>
                                <p class="text-sm text-gray-600 mt-1">${projeto.rodovia}</p>
                            </div>
                            <div class="p-4 bg-gray-50">
                                <div class="flex justify-between text-sm mb-3">
                                    <span class="text-gray-600">Progresso:</span>
                                    <span class="font-medium">${projeto.progresso || 0}%</span>
                                </div>
                                <div class="bg-gray-200 rounded-full h-2.5 mb-4">
                                    <div class="bg-indigo-600 h-2.5 rounded-full" style="width: ${projeto.progresso || 0}%"></div>
                                </div>
                                <div class="grid grid-cols-2 gap-3 text-sm">
                                    <div>
                                        <span class="text-gray-500">Início:</span>
                                        <span class="block font-medium">${formatarData(projeto.dataInicio)}</span>
                                    </div>
                                    <div>
                                        <span class="text-gray-500">Término:</span>
                                        <span class="block font-medium">${formatarData(projeto.dataFim)}</span>
                                    </div>
                                    <div class="col-span-2">
                                        <span class="text-gray-500">Cliente:</span>
                                        <span class="block font-medium">${projeto.cliente}</span>
                                    </div>
                                </div>
                            </div>
                            <div class="p-3 bg-gray-100 border-t flex justify-between">
                                <span class="text-sm ${diasRestantes < 0 ? 'text-red-600' : diasRestantes < 30 ? 'text-yellow-600' : 'text-green-600'}">
                                    <i class="fas fa-calendar-day mr-1"></i>
                                    ${diasRestantes < 0 ? `${Math.abs(diasRestantes)} dias de atraso` : diasRestantes === 0 ? 'Vence hoje' : `${diasRestantes} dias restantes`}
                                </span>
                                <button class="btn-visualizar-projeto text-indigo-600 hover:text-indigo-800">
                                    <i class="fas fa-eye mr-1"></i>Detalhes
                                </button>
                            </div>
                        </div>
                    `;
                    
                    listaProjetos.insertAdjacentHTML('beforeend', card);
                });
                
                // Adicionar eventos aos botões de detalhes
                document.querySelectorAll('.btn-visualizar-projeto').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const projetoId = this.closest('.custom-card').dataset.id;
                        abrirVisualizacaoProjeto(projetoId);
                    });
                });
            }

            function atualizarListaDisciplinas() {
                listaDisciplinas.innerHTML = '';
                
                disciplinas.forEach(disciplina => {
                    const row = `
                        <tr data-id="${disciplina.id}">
                            <td>${disciplina.nome}</td>
                            <td>
                                <div class="flex items-center">
                                    <span class="inline-block w-6 h-6 rounded-full mr-2" style="background-color: ${disciplina.cor}"></span>
                                    ${disciplina.cor}
                                </div>
                            </td>
                            <td>
                                <div class="flex space-x-2">
                                    <button class="btn-editar-disciplina text-blue-600 hover:text-blue-800">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn-excluir-disciplina text-red-600 hover:text-red-800">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                    
                    listaDisciplinas.insertAdjacentHTML('beforeend', row);
                });
                
                // Adicionar eventos aos botões
                document.querySelectorAll('.btn-editar-disciplina').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const disciplinaId = this.closest('tr').dataset.id;
                        const disciplina = disciplinas.find(d => d.id === disciplinaId);
                        
                        if (disciplina) {
                            document.getElementById('nomeDisciplina').value = disciplina.nome;
                            document.getElementById('corDisciplina').value = disciplina.cor;
                            document.getElementById('btnAdicionarDisciplina').textContent = 'Atualizar';
                            document.getElementById('btnAdicionarDisciplina').dataset.id = disciplinaId;
                        }
                    });
                });
                
                document.querySelectorAll('.btn-excluir-disciplina').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const disciplinaId = this.closest('tr').dataset.id;
                        const disciplina = disciplinas.find(d => d.id === disciplinaId);
                        
                        if (disciplina) {
                            exibirConfirmacao('disciplina', disciplinaId, `Tem certeza que deseja excluir a disciplina "${disciplina.nome}"?`);
                        }
                    });
                });
            }

            function atualizarDisciplinasProjeto() {
                disciplinasProjeto.innerHTML = '';
                
                if (disciplinas.length === 0) {
                    document.getElementById('semDisciplinas').classList.remove('hidden');
                    return;
                } else {
                    document.getElementById('semDisciplinas').classList.add('hidden');
                }
                
                let projetoAtual = null;
                
                if (projetoAtualId) {
                    projetoAtual = projetos.find(p => p.id === projetoAtualId);
                }
                
                disciplinas.forEach(disciplina => {
                    // Verificar se o projeto tem esta disciplina
                    let progresso = '0';
                    let observacoes = '';
                    
                    if (projetoAtual && projetoAtual.disciplinas) {
                        const disciplinaProjeto = projetoAtual.disciplinas.find(d => d.disciplinaId === disciplina.id);
                        if (disciplinaProjeto) {
                            progresso = disciplinaProjeto.progresso || '0';
                            observacoes = disciplinaProjeto.observacoes || '';
                        }
                    }
                    
                    const card = `
                        <div class="p-4 border rounded-lg" data-disciplina-id="${disciplina.id}">
                            <div class="flex justify-between mb-3">
                                <h4 class="font-medium flex items-center">
                                    <span class="inline-block w-3 h-3 rounded-full mr-2" style="background-color: ${disciplina.cor}"></span>
                                    ${disciplina.nome}
                                </h4>
                                <div class="flex items-center">
                                    <label class="mr-2 text-sm text-gray-600">Progresso:</label>
                                    <input type="number" class="disciplina-progresso border rounded w-16 px-2 py-1" min="0" max="100" value="${progresso}">
                                    <span class="ml-1">%</span>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm text-gray-600 mb-1">Observações:</label>
                                <textarea class="disciplina-observacoes w-full px-3 py-2 border rounded-md focus:ring-indigo-500 focus:border-indigo-500" rows="2">${observacoes}</textarea>
                            </div>
                        </div>
                    `;
                    
                    disciplinasProjeto.insertAdjacentHTML('beforeend', card);
                });
            }

            // Funções de visualização de projeto
            function abrirVisualizacaoProjeto(projetoId) {
                const projeto = projetos.find(p => p.id === projetoId);
                
                if (!projeto) return;
                
                document.getElementById('tituloProjetoView').textContent = projeto.nome;
                document.getElementById('viewNomeProjeto').textContent = projeto.nome;
                document.getElementById('viewCodigoProjeto').textContent = projeto.codigo || '-';
                document.getElementById('viewRodovia').textContent = projeto.rodovia;
                document.getElementById('viewCliente').textContent = projeto.cliente;
                document.getElementById('viewGerente').textContent = projeto.gerente;
                
                // Status com cor
                const viewStatus = document.getElementById('viewStatus');
                viewStatus.textContent = projeto.status;
                viewStatus.className = 'inline-block px-2 py-1 rounded text-white';
                
                switch(projeto.status) {
                    case 'Não Iniciado': viewStatus.classList.add('status-nao-iniciado'); break;
                    case 'Em Andamento': viewStatus.classList.add('status-em-andamento'); break;
                    case 'Atrasado': viewStatus.classList.add('status-atrasado'); break;
                    case 'Concluído': viewStatus.classList.add('status-concluido'); break;
                    case 'Suspenso': viewStatus.classList.add('status-suspenso'); break;
                }
                
                document.getElementById('viewDataInicio').textContent = formatarData(projeto.dataInicio);
                document.getElementById('viewDataFim').textContent = formatarData(projeto.dataFim);
                document.getElementById('viewDescricao').textContent = projeto.descricao || '-';
                
                // Progresso
                const progresso = projeto.progresso || '0';
                document.getElementById('viewProgresso').style.width = `${progresso}%`;
                document.getElementById('viewProgressoTexto').textContent = `${progresso}%`;
                
                // Atualizar disciplinas
                atualizarDisciplinasVisualizacao(projeto);
                
                // Atualizar cronograma
                atualizarCronograma(projeto);
                
                // Guardar referência
                projetoAtualId = projetoId;
                
                // Exibir modal
                modalVisualizarProjeto.classList.remove('hidden');
                
                // Ativar a primeira tab
                const tabs = document.querySelectorAll('.tab-button');
                tabs.forEach(tab => tab.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(content => content.classList.add('hidden'));
                
                document.querySelector('.tab-button[data-tab="tab-informacoes"]').classList.add('active');
                document.getElementById('tab-informacoes').classList.remove('hidden');
            }

            function atualizarDisciplinasVisualizacao(projeto) {
                const viewDisciplinas = document.getElementById('viewDisciplinas');
                viewDisciplinas.innerHTML = '';
                
                if (!projeto.disciplinas || projeto.disciplinas.length === 0) {
                    document.getElementById('viewSemDisciplinas').classList.remove('hidden');
                    return;
                } else {
                    document.getElementById('viewSemDisciplinas').classList.add('hidden');
                }
                
                projeto.disciplinas.forEach(projetoDisciplina => {
                    const disciplina = disciplinas.find(d => d.id === projetoDisciplina.disciplinaId);
                    
                    if (!disciplina) return;
                    
                    const card = `
                        <div class="border rounded-lg overflow-hidden">
                            <div class="p-3 bg-gray-50 border-b flex justify-between items-center">
                                <h4 class="font-medium flex items-center">
                                    <span class="inline-block w-3 h-3 rounded-full mr-2" style="background-color: ${disciplina.cor}"></span>
                                    ${disciplina.nome}
                                </h4>
                                <span class="text-sm font-medium">${projetoDisciplina.progresso || 0}% concluído</span>
                            </div>
                            <div class="p-4">
                                <div class="bg-gray-200 rounded-full h-2.5 mb-4">
                                    <div class="rounded-full h-2.5" style="width: ${projetoDisciplina.progresso || 0}%; background-color: ${disciplina.cor}"></div>
                                </div>
                                <div class="mt-2">
                                    <h5 class="text-sm font-medium text-gray-700 mb-1">Observações:</h5>
                                    <p class="text-sm text-gray-600">${projetoDisciplina.observacoes || 'Nenhuma observação registrada.'}</p>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    viewDisciplinas.insertAdjacentHTML('beforeend', card);
                });
            }

            function atualizarCronograma(projeto) {
                const viewCronograma = document.getElementById('viewCronograma');
                viewCronograma.innerHTML = '';
                
                // Configuração do cronograma
                const hoje = new Date();
                const dataInicio = new Date(projeto.dataInicio);
                const dataFim = new Date(projeto.dataFim);
                
                // Calcular duração total em dias
                const duracaoTotal = Math.ceil((dataFim - dataInicio) / (1000 * 60 * 60 * 24));
                
                // Criar linha do tempo (escala)
                const timeline = document.createElement('div');
                timeline.style.height = '30px';
                timeline.style.borderBottom = '1px solid #ddd';
                timeline.style.marginBottom = '10px';
                timeline.style.display = 'flex';
                
                // Adicionar marcações de tempo (meses)
                const mesesProjeto = [];
                let dataAtual = new Date(dataInicio);
                
                while (dataAtual <= dataFim) {
                    const mes = dataAtual.toLocaleString('pt-BR', { month: 'short' });
                    const ano = dataAtual.getFullYear();
                    mesesProjeto.push(`${mes} ${ano}`);
                    
                    // Avançar para o próximo mês
                    dataAtual.setMonth(dataAtual.getMonth() + 1);
                }
                
                // Largura por mês em pixels
                const larguraMes = 100;
                const larguraTotal = mesesProjeto.length * larguraMes;
                
                viewCronograma.style.width = `${larguraTotal}px`;
                
                // Adicionar meses à linha do tempo
                mesesProjeto.forEach((mes, index) => {
                    const mesDiv = document.createElement('div');
                    mesDiv.textContent = mes;
                    mesDiv.style.width = `${larguraMes}px`;
                    mesDiv.style.textAlign = 'center';
                    mesDiv.style.borderRight = '1px solid #ddd';
                    mesDiv.style.fontSize = '12px';
                    mesDiv.style.color = '#666';
                    timeline.appendChild(mesDiv);
                });
                
                viewCronograma.appendChild(timeline);
                
                // Adicionar linha do projeto
                const barraContainer = document.createElement('div');
                barraContainer.style.height = '40px';
                barraContainer.style.position = 'relative';
                barraContainer.style.marginBottom = '10px';
                
                // Adicionar linha do projeto principal
                const barraProjeto = document.createElement('div');
                barraProjeto.className = 'gantt-bar';
                barraProjeto.style.backgroundColor = '#93c5fd';
                barraProjeto.style.border = '1px solid #3b82f6';
                barraProjeto.style.width = `${larguraTotal}px`;
                barraProjeto.style.top = '10px';
                barraProjeto.style.zIndex = '1';
                barraProjeto.textContent = `${projeto.nome} (${projeto.progresso || 0}%)`;
                barraProjeto.style.paddingLeft = '8px';
                barraProjeto.style.overflow = 'hidden';
                barraProjeto.style.textOverflow = 'ellipsis';
                barraProjeto.style.whiteSpace = 'nowrap';
                barraProjeto.style.color = '#1e40af';
                barraProjeto.style.fontWeight = '500';
                barraProjeto.style.fontSize = '14px';
                
                barraContainer.appendChild(barraProjeto);
                viewCronograma.appendChild(barraContainer);
                
                // Adicionar linha para cada disciplina
                if (projeto.disciplinas && projeto.disciplinas.length > 0) {
                    projeto.disciplinas.forEach((projetoDisciplina, index) => {
                        const disciplina = disciplinas.find(d => d.id === projetoDisciplina.disciplinaId);
                        
                        if (!disciplina) return;
                        
                        const disciplinaContainer = document.createElement('div');
                        disciplinaContainer.style.height = '30px';
                        disciplinaContainer.style.position = 'relative';
                        disciplinaContainer.style.marginBottom = '8px';
                        
                        // Adicionar label da disciplina
                        const labelDiv = document.createElement('div');
                        labelDiv.style.position = 'absolute';
                        labelDiv.style.left = '0';
                        labelDiv.style.top = '0';
                        labelDiv.style.width = '150px';
                        labelDiv.style.overflow = 'hidden';
                        labelDiv.style.textOverflow = 'ellipsis';
                        labelDiv.style.whiteSpace = 'nowrap';
                        labelDiv.style.fontSize = '12px';
                        labelDiv.textContent = disciplina.nome;
                        
                        // Adicionar barra da disciplina
                        const barraDisciplina = document.createElement('div');
                        barraDisciplina.className = 'gantt-bar';
                        barraDisciplina.style.backgroundColor = disciplina.cor;
                        barraDisciplina.style.opacity = '0.8';
                        barraDisciplina.style.width = `${(parseInt(projetoDisciplina.progresso) / 100) * larguraTotal}px`;
                        barraDisciplina.style.left = '0';
                        barraDisciplina.style.top = '0';
                        barraDisciplina.style.height = '20px';
                        
                        disciplinaContainer.appendChild(barraDisciplina);
                        disciplinaContainer.appendChild(labelDiv);
                        viewCronograma.appendChild(disciplinaContainer);
                    });
                }
                
                // Adicionar linha vertical para 'hoje'
                if (hoje >= dataInicio && hoje <= dataFim) {
                    const diasPassados = Math.ceil((hoje - dataInicio) / (1000 * 60 * 60 * 24));
                    const posicaoHoje = (diasPassados / duracaoTotal) * larguraTotal;
                    
                    const linhaHoje = document.createElement('div');
                    linhaHoje.style.position = 'absolute';
                    linhaHoje.style.top = '30px';
                    linhaHoje.style.bottom = '0';
                    linhaHoje.style.left = `${posicaoHoje}px`;
                    linhaHoje.style.width = '2px';
                    linhaHoje.style.backgroundColor = '#dc2626';
                    linhaHoje.style.zIndex = '10';
                    
                    const labelHoje = document.createElement('div');
                    labelHoje.style.position = 'absolute';
                    labelHoje.style.top = '0';
                    labelHoje.style.left = `${posicaoHoje - 20}px`;
                    labelHoje.style.backgroundColor = '#dc2626';
                    labelHoje.style.color = 'white';
                    labelHoje.style.padding = '2px 6px';
                    labelHoje.style.borderRadius = '4px';
                    labelHoje.style.fontSize = '10px';
                    labelHoje.textContent = 'HOJE';
                    
                    viewCronograma.appendChild(linhaHoje);
                    viewCronograma.appendChild(labelHoje);
                }
            }

            // Funções utilitárias
            function formatarData(dataString) {
                if (!dataString) return '-';
                
                const data = new Date(dataString);
                return data.toLocaleDateString('pt-BR');
            }

            function gerarId() {
                return Date.now().toString(36) + Math.random().toString(36).substring(2);
            }

            function salvarDados() {
                localStorage.setItem('projetos', JSON.stringify(projetos));
                localStorage.setItem('disciplinas', JSON.stringify(disciplinas));
            }

            function exibirConfirmacao(tipo, id, mensagem) {
                document.getElementById('mensagemConfirmacao').textContent = mensagem;
                itemParaExcluir = id;
                tipoExclusao = tipo;
                modalConfirmacao.classList.remove('hidden');
            }

            // Disciplinas padrão
            function carregarDisciplinasPadrao() {
                const disciplinasPadrao = [
                    { id: gerarId(), nome: "Estudos Topográficos", cor: "#4F46E5" },
                    { id: gerarId(), nome: "Estudos Geológicos/Geotécnicos", cor: "#7C3AED" },
                    { id: gerarId(), nome: "Estudos Hidrológicos", cor: "#0EA5E9" },
                    { id: gerarId(), nome: "Projeto Geométrico", cor: "#10B981" },
                    { id: gerarId(), nome: "Projeto de Terraplenagem", cor: "#F59E0B" },
                    { id: gerarId(), nome: "Projeto de Drenagem", cor: "#3B82F6" },
                    { id: gerarId(), nome: "Projeto de Pavimentação", cor: "#EF4444" },
                    { id: gerarId(), nome: "Projeto de OAEs", cor: "#8B5CF6" },
                    { id: gerarId(), nome: "Projeto de Sinalização", cor: "#EC4899" },
                    { id: gerarId(), nome: "Estudos Ambientais", cor: "#65A30D" },
                    { id: gerarId(), nome: "Orçamento e Quantitativos", cor: "#0369A1" },
                    { id: gerarId(), nome: "Desapropriações", cor: "#A16207" }
                ];
                
                // Adicionar apenas as disciplinas que ainda não existem
                disciplinasPadrao.forEach(disciplinaPadrao => {
                    const disciplinaExiste = disciplinas.some(d => d.nome === disciplinaPadrao.nome);
                    
                    if (!disciplinaExiste) {
                        disciplinas.push(disciplinaPadrao);
                    }
                });
                
                salvarDados();
                atualizarListaDisciplinas();
                atualizarFiltroDisciplinas();
                
                document.getElementById('nenhumaDisciplina').classList.add('hidden');
                document.getElementById('semDisciplinas').classList.add('hidden');
                
                alert('Disciplinas padrão carregadas com sucesso!');
            }

            // Event Listeners
            // Botões de navegação
            document.getElementById('btnNovoProjeto').addEventListener('click', function() {
                formProjeto.reset();
                document.getElementById('tituloModalProjeto').textContent = 'Novo Projeto';
                document.getElementById('projetoId').value = '';
                projetoAtualId = null;
                document.getElementById('btnSalvarProjeto').textContent = 'Salvar Projeto';
                valorProgresso.textContent = '0%';
                atualizarDisciplinasProjeto();
                modalProjeto.classList.remove('hidden');
            });

            document.getElementById('btnGerenciarDisciplinas').addEventListener('click', function() {
                formDisciplina.reset();
                document.getElementById('btnAdicionarDisciplina').textContent = 'Adicionar';
                document.getElementById('btnAdicionarDisciplina').dataset.id = '';
                atualizarListaDisciplinas();
                modalDisciplinas.classList.remove('hidden');
            });

            // Formulário de Projeto
            formProjeto.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const id = document.getElementById('projetoId').value || gerarId();
                const nome = document.getElementById('nomeProjeto').value;
                const codigo = document.getElementById('codigoProjeto').value;
                const rodovia = document.getElementById('rodovia').value;
                const status = document.getElementById('statusProjeto').value;
                const cliente = document.getElementById('cliente').value;
                const gerente = document.getElementById('gerente').value;
                const dataInicio = document.getElementById('dataInicio').value;
                const dataFim = document.getElementById('dataFim').value;
                const descricao = document.getElementById('descricaoProjeto').value;
                const progresso = document.getElementById('progressoGlobal').value;
                
                // Coletar dados das disciplinas do projeto
                const disciplinasProjeto = [];
                document.querySelectorAll('#disciplinasProjeto > div').forEach(div => {
                    const disciplinaId = div.dataset.disciplinaId;
                    const progressoInput = div.querySelector('.disciplina-progresso');
                    const observacoesInput = div.querySelector('.disciplina-observacoes');
                    
                    if (disciplinaId && progressoInput && observacoesInput) {
                        disciplinasProjeto.push({
                            disciplinaId: disciplinaId,
                            progresso: progressoInput.value,
                            observacoes: observacoesInput.value
                        });
                    }
                });
                
                const projeto = {
                    id,
                    nome,
                    codigo,
                    rodovia,
                    status,
                    cliente,
                    gerente,
                    dataInicio,
                    dataFim,
                    descricao,
                    progresso,
                    disciplinas: disciplinasProjeto,
                    ultimaAtualizacao: new Date().toISOString()
                };
                
                // Atualizar ou adicionar
                const index = projetos.findIndex(p => p.id === id);
                
                if (index !== -1) {
                    projetos[index] = projeto;
                } else {
                    projetos.push(projeto);
                }
                
                salvarDados();
                atualizarContadores();
                carregarProjetos();
                modalProjeto.classList.add('hidden');
            });

            // Formulário de Disciplina
            formDisciplina.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const nome = document.getElementById('nomeDisciplina').value;
                const cor = document.getElementById('corDisciplina').value;
                const id = document.getElementById('btnAdicionarDisciplina').dataset.id || gerarId();
                
                if (document.getElementById('btnAdicionarDisciplina').dataset.id) {
                    // Atualizar disciplina existente
                    const index = disciplinas.findIndex(d => d.id === id);
                    
                    if (index !== -1) {
                        disciplinas[index].nome = nome;
                        disciplinas[index].cor = cor;
                    }
                } else {
                    // Adicionar nova disciplina
                    disciplinas.push({ id, nome, cor });
                }
                
                salvarDados();
                atualizarListaDisciplinas();
                atualizarFiltroDisciplinas();
                
                // Resetar formulário
                formDisciplina.reset();
                document.getElementById('btnAdicionarDisciplina').textContent = 'Adicionar';
                document.getElementById('btnAdicionarDisciplina').dataset.id = '';
                
                // Esconder mensagem de nenhuma disciplina
                document.getElementById('nenhumaDisciplina').classList.add('hidden');
                document.getElementById('semDisciplinas').classList.add('hidden');
            });

            // Botão Carregar Disciplinas Padrão
            document.getElementById('btnCarregarPadrao').addEventListener('click', carregarDisciplinasPadrao);

            // Botões de fechar modais
            document.getElementById('btnCancelarProjeto').addEventListener('click', function() {
                modalProjeto.classList.add('hidden');
            });

            document.getElementById('btnFecharDisciplinas').addEventListener('click', function() {
                modalDisciplinas.classList.add('hidden');
            });

            document.getElementById('btnFecharVisualizacao').addEventListener('click', function() {
                modalVisualizarProjeto.classList.add('hidden');
            });

            // Botões de editar e excluir projeto
            document.getElementById('btnEditarProjeto').addEventListener('click', function() {
                if (!projetoAtualId) return;
                
                const projeto = projetos.find(p => p.id === projetoAtualId);
                
                if (!projeto) return;
                
                // Preencher formulário
                document.getElementById('projetoId').value = projeto.id;
                document.getElementById('nomeProjeto').value = projeto.nome;
                document.getElementById('codigoProjeto').value = projeto.codigo || '';
                document.getElementById('rodovia').value = projeto.rodovia;
                document.getElementById('statusProjeto').value = projeto.status;
                document.getElementById('cliente').value = projeto.cliente;
                document.getElementById('gerente').value = projeto.gerente;
                document.getElementById('dataInicio').value = projeto.dataInicio;
                document.getElementById('dataFim').value = projeto.dataFim;
                document.getElementById('descricaoProjeto').value = projeto.descricao || '';
                document.getElementById('progressoGlobal').value = projeto.progresso || 0;
                valorProgresso.textContent = (projeto.progresso || 0) + '%';
                
                document.getElementById('tituloModalProjeto').textContent = 'Editar Projeto';
                document.getElementById('btnSalvarProjeto').textContent = 'Atualizar Projeto';
                
                // Atualizar disciplinas
                atualizarDisciplinasProjeto();
                
                modalVisualizarProjeto.classList.add('hidden');
                modalProjeto.classList.remove('hidden');
            });

            document.getElementById('btnDeletarProjeto').addEventListener('click', function() {
                if (!projetoAtualId) return;
                
                const projeto = projetos.find(p => p.id === projetoAtualId);
                
                if (projeto) {
                    exibirConfirmacao('projeto', projetoAtualId, `Tem certeza que deseja excluir o projeto "${projeto.nome}"?`);
                }
            });

            // Botões de confirmação
            document.getElementById('btnCancelarConfirmacao').addEventListener('click', function() {
                modalConfirmacao.classList.add('hidden');
                itemParaExcluir = null;
                tipoExclusao = null;
            });

            document.getElementById('btnConfirmarExclusao').addEventListener('click', function() {
                if (!itemParaExcluir || !tipoExclusao) return;
                
                if (tipoExclusao === 'projeto') {
                    projetos = projetos.filter(p => p.id !== itemParaExcluir);
                    modalVisualizarProjeto.classList.add('hidden');
                } else if (tipoExclusao === 'disciplina') {
                    disciplinas = disciplinas.filter(d => d.id !== itemParaExcluir);
                    
                    // Também remover esta disciplina de todos os projetos
                    projetos.forEach(projeto => {
                        if (projeto.disciplinas) {
                            projeto.disciplinas = projeto.disciplinas.filter(d => d.disciplinaId !== itemParaExcluir);
                        }
                    });
                }
                
                salvarDados();
                atualizarContadores();
                carregarProjetos();
                atualizarListaDisciplinas();
                atualizarFiltroDisciplinas();
                
                modalConfirmacao.classList.add('hidden');
                itemParaExcluir = null;
                tipoExclusao = null;
            });

            // Tabs de visualização
            document.querySelectorAll('.tab-button').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.dataset.tab;
                    
                    // Desativar todas as tabs
                    document.querySelectorAll('.tab-button').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
                    
                    // Ativar a tab selecionada
                    this.classList.add('active');
                    document.getElementById(tabId).classList.remove('hidden');
                });
            });

            // Filtros e pesquisa
            document.getElementById('pesquisaProjeto').addEventListener('input', carregarProjetos);
            document.getElementById('filtroStatus').addEventListener('change', carregarProjetos);
            document.getElementById('filtroDisciplina').addEventListener('change', carregarProjetos);
            document.getElementById('ordenarPor').addEventListener('change', carregarProjetos);
            
            document.getElementById('btnLimparFiltros').addEventListener('click', function() {
                document.getElementById('pesquisaProjeto').value = '';
                document.getElementById('filtroStatus').value = '';
                document.getElementById('filtroDisciplina').value = '';
                document.getElementById('ordenarPor').value = 'nome';
                carregarProjetos();
            });

            // Inicializar a aplicação
            inicializar();
        });
    </script>
</body>
</html>